#!/bin/bash
set -e

SFPROCESSOR=/usr/bin/sfprocessor
SFCOLLECTOR=/usr/bin/sysporter
#SFENV=/etc/sysflow/conf/sysflow.env

status () {
    systemctl status sysflow*
}

start () {
    if test -f "$ENVFILE"; then
        echo "SysFlow service configuration file not found in $CONFIGPATH"
    fi
    if test -f "$SFPROCESSOR"; then
        systemctl enable sysflow sysflow-processor
    fi
    if test -f "$SFCOLLECTOR"; then
        systemctl enable sysflow sysflow-collector
        #if test -f ""$SFENV; then
        #fi
    fi
    systemctl start sysflow
}

stop () {
    systemctl stop sysflow
    if test -f "$SFPROCESSOR"; then
        systemctl disable sysflow sysflow-processor
    fi
    if test -f "$SFCOLLECTOR"; then
        systemctl disable sysflow sysflow-collector
    fi
    systemctl daemon-reload
    systemctl reset-failed
}

systemctl daemon-reload
if [ "$1" == "status" ]; then
  status
elif [ "$1" == "start" ]; then
  echo "Starting SysFlow..."
  start
elif [ "$1" == "stop" ]; then
  echo "Stopping SysFlow..."
  stop
else
  echo "Usage: sysflow [status|start|stop]"
fi

